<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <h1 class="score">0</h1>
    <div class="container"></div>
  </body>
  <style>
    .score {
      text-align: center;
    }
    .container {
      display: grid;
      justify-self: center;
      width: 400px;
      height: 400px;
      grid-template-columns: repeat(10, 1fr);
      grid-template-rows: repeat(10, 1fr);
      gap: 0;
    }

    .container div {
      border: 1px solid black;
    }
  </style>
  <script>
    const container = document.querySelector(".container");
    const scoreDisplay = document.querySelector(".score");
    let divs = [];

    score = 0;

    for (let x = 0; x < 10; x++) {
      divs[x] = [];

      for (let y = 0; y < 10; y++) {
        const div = document.createElement("div");
        container.appendChild(div);
        divs[x][y] = div;
      }
    }
    previousPlayerLastPos = [4, 4];
    playerPos = [4, 4];
    playerPositions = [playerPos];
    divs[playerPos[0]][playerPos[1]].style.backgroundColor = "red";

    applePos = [Math.floor(Math.random() * 10), Math.floor(Math.random() * 10)];
    divs[applePos[0]][applePos[1]].style.backgroundImage = "url('apple.png')";
    divs[applePos[0]][applePos[1]].style.backgroundSize = "cover";

    function wipeBoard() {
      for (let x = 0; x < 10; x++) {
        for (let y = 0; y < 10; y++) {
          divs[x][y].style.backgroundColor = "white";
        }
      }
    }

    function updateApple() {
      for (let i = 0; i < playerPositions.length; i++) {
        divs[playerPositions[i][0]][
          playerPositions[i][1]
        ].style.backgroundColor = "red";
      }
      if (playerPos[0] === applePos[0] && playerPos[1] === applePos[1]) {
        divs[applePos[0]][applePos[1]].style.backgroundImage = "none";
        score++;
        scoreDisplay.textContent = score;

        do {
          applePos = [
            Math.floor(Math.random() * 10),
            Math.floor(Math.random() * 10),
          ];
        } while (
          playerPositions.some(
            (pos) => pos[0] === applePos[0] && pos[1] === applePos[1]
          )
        );

        divs[applePos[0]][applePos[1]].style.backgroundImage =
          "url('apple.png')";
        divs[applePos[0]][applePos[1]].style.backgroundSize = "cover";

        playerPositions.push([...playerPos]);
      }
    }

    let state = "ArrowRight";
    document.addEventListener("keydown", (event) => {
      if (
        (state == "ArrowRight" && event.key == "ArrowLeft") ||
        (state == "ArrowLeft" && event.key == "ArrowRight") ||
        (state == "ArrowUp" && event.key == "ArrowDown") ||
        (state == "ArrowDown" && event.key == "ArrowUp")
      ) {
        return;
      } else if (
        event.key == "ArrowRight" ||
        event.key == "ArrowLeft" ||
        event.key == "ArrowUp" ||
        event.key == "ArrowDown"
      ) {
        state = event.key;
      }
    });
    setInterval(updatePlayer, 150);

    function updatePlayer() {
      //gjør at alt følger hodet
      for (let i = playerPositions.length - 1; i > 0; i--) {
        playerPositions[i] = [...playerPositions[i - 1]];
      }

      //gjør at hodet beveger seg etter
      if (state == "ArrowRight") playerPositions[0][1]++;
      else if (state == "ArrowLeft") playerPositions[0][1]--;
      else if (state == "ArrowUp") playerPositions[0][0]--;
      else if (state == "ArrowDown") playerPositions[0][0]++;

      //ny spillerposisjon
      playerPos = [...playerPositions[0]];
      checkGameOver();
      wipeBoard();
      updateApple();
    }

    let gameOver = false;

    function checkGameOver() {
      if (gameOver) return;
      if (
        playerPos[0] < 0 ||
        playerPos[0] > 9 ||
        playerPos[1] < 0 ||
        playerPos[1] > 9
      ) {
        gameOver = true; // stop further alerts
        alert("Game over");
        location.reload();
      }

      for (let i = 1; i < playerPositions.length; i++) {
        if (
          playerPos[0] === playerPositions[i][0] &&
          playerPos[1] === playerPositions[i][1]
        ) {
          gameOver = true;
          alert("Game over");
          location.reload();
        }
      }
    }
  </script>
</html>
